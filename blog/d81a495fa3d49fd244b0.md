---
title: Azure上のWindowsServer2016で、VDIサーバを構築する（更新中）
tags: Azure Windows
author: hiroyannnn
slide: false
---
# 実施すること
Azure上に仮想デスクトップコレクションを展開して、RDS経由でWindows10にログインする。

# 1.Azureリソース
## 1.初期デプロイ
jsonを使ってデプロイする
**やること**
・リソースグループの作成
・仮想ネットワークの作成
・ストレージアカウントの作成

以下はjsonファイル

```xxx.json
ｘｘｘ
```

## 2.HVサーバのデプロイ
ポータルからポチポチ作成する

以下はjsonファイル

```xxx.json
ｘｘｘ
```

## 3.DNS名の登録
RDPが楽になるので、pipにDNS名を登録しておく

# 2.HVサーバの構築
## 1.Networkの信頼
Networkを信頼する

## 2.日本語化
以下のURLを参考に、日本語化を実施する
https://kogelog.com/2016/10/18/20161018-01/

Powershellで実行するのが良い。

## 3.WindowsUpdate
下記を参考に、Powershellで実行する。
[Windows Server 2012 / 2012 R2 の Windows Update による定期的なパッチ適用のメモ](https://blog.engineer-memo.com/2015/07/27/windows-server-2012-2012-r2-%E3%81%AE-windows-update-%E3%81%AB%E3%82%88%E3%82%8B%E5%AE%9A%E6%9C%9F%E7%9A%84%E3%81%AA%E3%83%91%E3%83%83%E3%83%81%E9%81%A9%E7%94%A8%E3%81%AE%E3%83%A1%E3%83%A2/)

## 4.ドメイン参加
今回は既に存在するADへ参加する

## 5.Hyper-Vの役割インストール

```Install-HV.ps1
Install-WindowsFeature -Name hyper-v, failover-clustering,Multipath-IO -IncludeManagementTools
```

## 6.仮想スイッチの作成
```make_vSwitch.ps1
$SwitchName = "vSwitch01"
$AdapterName = "vEthernet ($SwitchName)"
$NAT_Gateway_IP ="192.168.10.1"
$NAT_Subnet_Prefix_Length ="24"
$NATOutsideName = "vNat01"
$NAT_subnet_prefix = "192.168.10.0/24"
New-VMSwitch -SwitchName $SwitchName -SwitchType Internal
$NewAdapter = Get-NetAdapter -Name  $AdapterName
$ifIndex = $NewAdapter.ifindex
New-NetIPAddress -IPAddress $NAT_Gateway_IP -PrefixLength $NAT_Subnet_Prefix_Length -InterfaceIndex $ifIndex
New-NetNat -Name $NATOutsideName -InternalIPInterfaceAddressPrefix $NAT_subnet_prefix
```

## 7.Windows10VMの作成

# 3.RDサーバの構築
## 8.コレクションの作成

Disk拡張
http://blog.yottun8.com/archives/594

バグ
https://satsumahomeserver.com/blog/3617

